<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>

        <style>
            * {
                font-family: system-ui, -apple-system, BlinkMacSystemFont,
                    "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans",
                    "Helvetica Neue", sans-serif;
            }

            td {
                padding: 5px;
            }
        </style>
    </head>
    <body>
        <table border="1">
            <thead>
                <tr>
                    <th>Ngày</th>
                    <th>Miền Bắc</th>
                    <th>Miền Trung</th>
                    <th>Miền Nam</th>
                </tr>
            </thead>

            <tbody id="rs"></tbody>
        </table>

        <script>
            const $ = (selector) => document.querySelector(selector);

            const token = {
                value: "",
            };

            const httpClient = {
                get: (url) => {
                    return fetch(url, {
                        headers: {
                            Authorization: `Bearer ${token.value}`,
                        },
                    }).then((res) => res.json());
                },
                post: (url, data) => {
                    return fetch(url, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            Authorization: `Bearer ${token.value}`,
                        },
                        body: JSON.stringify(data || {}),
                    }).then((res) => res.json());
                },
                put: (url, data) => {
                    return fetch(url, {
                        method: "PUT",
                        headers: {
                            "Content-Type": "application/json",
                            Authorization: `Bearer ${token.value}`,
                        },
                        body: JSON.stringify(data || {}),
                    }).then((res) => res.json());
                },
                delete: (url, data) => {
                    return fetch(url, {
                        method: "DELETE",
                        headers: {
                            Authorization: `Bearer ${token.value}`,
                        },
                    }).then((res) => res.json());
                },
            };
        </script>

        <script>
            const main = async () => {
                const kqxs = await httpClient.get("/api/kqxs");

                const dates = {};

                kqxs.forEach((e) => {
                    if (!dates[e.ngay]) {
                        dates[e.ngay] = [e];
                    } else {
                        dates[e.ngay].push(e);
                    }
                });

                console.log(dates);
                console.log(kqxs);

                $("#rs").innerHTML = Object.keys(dates)
                    .map((e) => {
                        const date = new Date(e);

                        return `
                        <tr>
                            <td>${date.getDate()}-${
                            date.getMonth() + 1
                        }-${date.getFullYear()}</td>
                            <td>${dates[e]
                                .filter((kq) => kq.domain === 1)
                                .map((kq) => {
                                    return kq.ketqua.giaidacbiet[0].slice(-2);
                                })
                                .join(", ")}</td>
                            <td>${dates[e]
                                .filter((kq) => kq.domain === 2)
                                .map((kq) => {
                                    return kq.ketqua.giaidacbiet[0].slice(-2);
                                })
                                .join(", ")}</td>
                            <td>${dates[e]
                                .filter((kq) => kq.domain === 3)
                                .map((kq) => {
                                    return kq.ketqua.giaidacbiet[0].slice(-2);
                                })
                                .join(", ")}</td>
                        </tr>
                    `;
                    })
                    .join("");
            };

            main();
        </script>
    </body>
</html>
